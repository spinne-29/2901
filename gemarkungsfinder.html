<!-- 


Gemarkungs-Finder

---- PD Hannover
---- PI Besondere Dienste
---- Zentraler Verkehrsdienst
---- Einsatz- und Streifendienst BAB


---- Änderungswünsche und Bug-Reports an:
---- lennart.spinneker@polizei.niedersachsen.de


######### ÄNDERUNGSPROTOKOLL #########




######### TO DO #########



-->

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" id="viewportMeta" content="width=device-width, initial-scale=1.0">
        <link rel="apple-touch-icon" sizes="180x180" href="gemarkungsfinder-touch-icon.png">
    <title>Gemarkungen</title>
    <style>
        
        body {
            font-family: sans-serif;
            background-color: #f4f4f4;
                        color: #575756;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0rem;
            margin: 0;
        }

        .app-container {
            width: 100%;
            max-width: 500px;
            background-color: #ffffff;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            border-radius: 0.75rem;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .header-title {
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            color: #0069b4;
        }

        .header-subtitle {
            text-align: center;
            font-size: 16px;
            color: #6b7280;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .input-label {
            color: #374151;
            font-weight: 500;
            display: block;
            margin-bottom: 0.25rem;
        }

        .input-flex-container {
            display: flex;
            gap: 0.75rem;
        }

        .text-input {
            flex-grow: 1;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
                        font-size: 16px;
            transition: border-color 150ms, box-shadow 150ms;
            background-color: white;
        }

        .text-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
                        font-size: 16px;
            outline: none;
        }

        .search-button {
            padding: 0.75rem 1.5rem;
            background-color: #2563eb;
            color: white;
            font-weight: 600;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            transition: background-color 150ms, transform 150ms;
            cursor: pointer;
            border: none;
                        font-size: 16px;

        }

        .search-button:hover {
            background-color: #1d4ed8;
        }
        
        .search-button:active {
            transform: scale(0.95);
        }
        
        .search-button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }

        .status-message {
            text-align: center;
            padding: 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 300ms;
        }

        .status-info { background-color: #dbeafe; color: #1e40af; }
        .status-error { background-color: #fee2e2; color: #b91c1c; }
        .status-success { background-color: #d1fae5; color: #065f46; }

        .results-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding-top: 0.5rem;
        }
        
        .results-container-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }

        /* Dynamische Ergebnis-Karten */
        .ergebnis-karte {
            padding: 1rem;
            background-color: #ffffff;
            border-radius: 0.5rem;
            border: 1px solid;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            transition: transform 300ms, box-shadow 300ms;
            animation: fadeIn 0.3s ease-out;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .ergebnis-karte-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #1f2937;
            padding-bottom: 0.25rem;
            border-bottom: 1px dashed #d1d5db;
        }

        .ergebnis-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .detail-label {
            font-weight: 500;
            color: #4b5563;
        }
        
        .detail-value {
            font-weight: 700;
            color: #1f2937;
        }

        .bereich-info {
            font-size: 0.75rem;
            text-align: right;
            color: #6b7280;
            padding-top: 0.25rem;
        }

        .objekt-info {
            font-size: 1rem;
            color: #2563eb;
            font-weight: 600;
            padding-top: 0.25rem;
        }

        /* Border colors for results */
        .border-yellow { border-color: #fcd34d; }
        .border-green { border-color: #6ee7b7; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .mode-toggle-container {
            display: flex;
            background-color: #e5e7eb;
            padding: 4px;
            border-radius: 0.5rem;
            box-shadow: inset 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        .mode-toggle-container input[type="radio"] {
            display: none;
        }

        .mode-toggle-button {
            flex: 1;
            text-align: center;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #4b5563;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }

        .mode-toggle-container input[type="radio"]:checked + .mode-toggle-button {
            background-color: #ffffff;
            color: #1f2937;
            box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1);
            font-weight: 600;
        }
       body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }

        body.dark-mode .app-container {
            background-color: #1e1e1e;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
        }

        /* Überschriften und Haupttextfarben */
        body.dark-mode .header-title,
        body.dark-mode .results-container-title,
        body.dark-mode .ergebnis-karte-title,
        body.dark-mode .detail-value {
            color: #f3f4f6; /* Sehr hell für Hauptüberschriften und Werte */
        }

        /* Sekundäre Textfarben */
        body.dark-mode .header-subtitle,
        body.dark-mode .input-label,
        body.dark-mode .detail-label,
        body.dark-mode .bereich-info {
            color: #9ca3af; /* Mittleres Hellgrau für Labels und Untertitel */
        }

        /* Eingabefelder */
        body.dark-mode .text-input {
            background-color: #4b5563; /* Dunklerer Input-Hintergrund */
            border-color: #6b7280; /* Hellerer Border */
            color: #f3f4f6;
        }

        body.dark-mode .text-input:focus {
            border-color: #60a5fa; /* Heller Blauer Fokus-Rand */
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3);
        }

        /* Buttons */
        body.dark-mode .search-button {
            background-color: #3b82f6; /* Haupt-Blau beibehalten */
            color: white;
            box-shadow: none;
        }

        body.dark-mode .search-button:hover {
            background-color: #60a5fa; /* Helleres Blau beim Hover */
        }

        body.dark-mode .search-button:disabled {
            background-color: #6b7280;
            cursor: not-allowed;
        }

        /* Ergebnis-Karten */
        body.dark-mode .ergebnis-karte {
            background-color: #1e1e1e;
            border-color: #4b5563;
            box-shadow: none;
        }

        body.dark-mode .ergebnis-karte-title {
            border-bottom: 1px dashed #6b7280; /* Hellerer gestrichelter Trennstrich */
        }

        body.dark-mode .objekt-info {
            color: #93c5fd; /* Helles Blau für hervorgehobene Info */
        }
        
        /* Ergebnis-Karten Border-Farben (heller für bessere Sichtbarkeit) */
        body.dark-mode .border-yellow { border-color: #facc15; }
        body.dark-mode .border-green { border-color: #34d399; }

        /* Status-Meldungen (kontrastreicher) */
        body.dark-mode .status-info { background-color: #1e3a8a; color: #93c5fd; }
        body.dark-mode .status-error { background-color: #7f1d1d; color: #fca5a5; }
        body.dark-mode .status-success { background-color: #065f46; color: #a7f3d0; }

        /* Mode Toggle */
        body.dark-mode .mode-toggle-container {
            background-color: #4b5563;
            box-shadow: inset 0 1px 3px 0 rgba(0, 0, 0, 0.4);
        }

        body.dark-mode .mode-toggle-button {
            color: #374151;
        }

        body.dark-mode .mode-toggle-container input[type="radio"]:checked + .mode-toggle-button {
            background-color: #374151; /* Dunklerer aktiver Hintergrund */
            color: #f3f4f6;
            box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="app-container">
        <h1 class="header-title">Gemarkungs-Finder</h1>
        <p class="header-subtitle">Für den Zuständigkeitsbereich des ESD BAB in der PD Hannover</p>
        <div class="input-group">
            <div>
                <label class="input-label">Suchmodus wählen</label>
                <div class="mode-toggle-container">
                    <input type="radio" id="modusKm" name="suchModus" value="kilometer" checked>
                    <label for="modusKm" class="mode-toggle-button">Kilometer</label>

                    <input type="radio" id="modusName" name="suchModus" value="name">
                    <label for="modusName" class="mode-toggle-button">Name</label>
                </div>
            </div>

            <label id="inputLabel" for="kilometerInput" class="input-label">Betriebskilometer eingeben</label>
            <div class="input-flex-container">
                <input type="text" id="kilometerInput" placeholder="Kilometer (z.B. 237,920)"
                       class="text-input">
                <button id="searchButton" 
                        class="search-button">
                    Suchen
                </button>
            </div>
            
        </div>

        <!-- Status und Ergebnisse -->
        <div id="statusMessage" class="status-message"></div>
        <div id="resultsContainer" class="results-container" style="display: none;">
            <h2 class="results-container-title">Gefundene Treffer:</h2>
 
        </div>
              <div style="text-align: center; margin-bottom: 25px;">
        <br>
            <label for="themeSwitcher" style="display: inline-block; width: auto;">Darstellung:</label>
            <select id="themeSwitcher" style="width: 150px; padding: 5px;">
                <option value="light">Hell</option>
                <option value="dark">Dunkel</option>
                <option value="auto">Automatisch</option>
            </select>
        </div>
  
    </div>

    <!-- Hauptlogik (für Offline-Verwendung) -->
    <script>
        let kilometerBereiche = [
   { autobahn: "A2", startKm: 197.3, endKm: 213.75, landkreis: "Region Hannover", gemarkung: "Lehrte ", postleitzahl: "31275", amtsgericht: "AG Lehrte ", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A2", startKm: 213.751, endKm: 216.3, landkreis: "LH Hannover", gemarkung: "Hannover (Misburg-Nord)", postleitzahl: "30629", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 216.301, endKm: 219.6, landkreis: "LH Hannover", gemarkung: "Hannover (Lahe)", postleitzahl: "30659", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 219.601, endKm: 220.8, landkreis: "LH Hannover", gemarkung: "Hannover (Bothfeld)", postleitzahl: "30659", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 220.801, endKm: 222.62, landkreis: "LH Hannover", gemarkung: "Hannover (Bothfeld)", postleitzahl: "30657", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 222.621, endKm: 223, landkreis: "LH Hannover", gemarkung: "Hannover (Sahlkamp)", postleitzahl: "30657", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 223.001, endKm: 223.3, landkreis: "LH Hannover", gemarkung: "Hannover (Sahlkamp)", postleitzahl: "30179", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 223.301, endKm: 225.8, landkreis: "LH Hannover", gemarkung: "Hannover (Vahrenheide)", postleitzahl: "30179", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 225.801, endKm: 226.85, landkreis: "LH Hannover", gemarkung: "Hannover (Brink-Hafen)", postleitzahl: "30179", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 226.851, endKm: 228.98, landkreis: "LH Hannover", gemarkung: "Hannover (Vinnhorst)", postleitzahl: "30419", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 228.981, endKm: 231.25, landkreis: "LH Hannover", gemarkung: "Hannover (Nordhafen)", postleitzahl: "30419", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 231.251, endKm: 233.74, landkreis: "LH Hannover", gemarkung: "Hannover (Stöcken)", postleitzahl: "30419", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 233.801, endKm: 239.97, landkreis: "Region Hannover", gemarkung: "Garbsen", postleitzahl: "30823", amtsgericht: "AG Neustadt", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 239.971, endKm: 242.9, landkreis: "Region Hannover", gemarkung: "Seelze", postleitzahl: "30926", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 242.901, endKm: 244.57, landkreis: "Region Hannover", gemarkung: "Barsinghausen", postleitzahl: "30890", amtsgericht: "AG Wennigsen", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 244.601, endKm: 248.35, landkreis: "Region Hannover", gemarkung: "Wunstorf", postleitzahl: "31515", amtsgericht: "AG Neustadt", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 248.351, endKm: 249.5, landkreis: "Region Hannover", gemarkung: "Barsinghausen", postleitzahl: "30890", amtsgericht: "AG Wennigsen", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 249.501, endKm: 252, landkreis: "LK Schaumburg", gemarkung: "Bad Nenndorf", postleitzahl: "31542", amtsgericht: "AG Stadthagen", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 252.001, endKm: 253.05, landkreis: "Region Hannover", gemarkung: "Barsinghausen", postleitzahl: "30890", amtsgericht: "AG Wennigsen", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2", startKm: 253.101, endKm: 254.25, landkreis: "LK Schaumburg", gemarkung: "Bad Nenndorf", postleitzahl: "31542", amtsgericht: "AG Stadthagen", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 254.251, endKm: 257.93, landkreis: "LK Schaumburg", gemarkung: "Rodenberg", postleitzahl: "31552", amtsgericht: "AG Stadthagen", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 257.931, endKm: 258.55, landkreis: "LK Schaumburg", gemarkung: "Lauenau, Flecken", postleitzahl: "31867", amtsgericht: "AG Stadthagen", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 258.551, endKm: 260.87, landkreis: "LK Schaumburg", gemarkung: "Apelern", postleitzahl: "31552", amtsgericht: "AG Stadthagen", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 260.871, endKm: 262.3, landkreis: "LK Schaumburg", gemarkung: "Pohle", postleitzahl: "31867", amtsgericht: "AG Stadthagen", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 262.301, endKm: 273.07, landkreis: "LK Schaumburg", gemarkung: "Auetal", postleitzahl: "31749", amtsgericht: "AG Stadthagen", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 273.071, endKm: 273.83, landkreis: "LK Schaumburg", gemarkung: "Rinteln, Stadt", postleitzahl: "31737", amtsgericht: "AG Rinteln", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 273.831, endKm: 275.45, landkreis: "LK Schaumburg", gemarkung: "Auetal", postleitzahl: "31749", amtsgericht: "AG Rinteln", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 275.451, endKm: 277.13, landkreis: "LK Schaumburg", gemarkung: "Rinteln, Stadt", postleitzahl: "31737", amtsgericht: "AG Rinteln", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 277.201, endKm: 277.89, landkreis: "LK Schaumburg", gemarkung: "Buchholz", postleitzahl: "31710", amtsgericht: "AG Rinteln", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 277.891, endKm: 278.63, landkreis: "LK Schaumburg", gemarkung: "Rinteln, Stadt", postleitzahl: "31737", amtsgericht: "AG Rinteln", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 278.661, endKm: 278.825, landkreis: "LK Schaumburg", gemarkung: "Heeßen", postleitzahl: "31707", amtsgericht: "AG Bückeburg", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2", startKm: 278.826, endKm: 279.15, landkreis: "LK Schaumburg", gemarkung: "Luhden", postleitzahl: "31711", amtsgericht: "AG Bückeburg", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2 (APW Herford)", startKm: 279.151, endKm: 280.81, landkreis: "LK Schaumburg", gemarkung: "Luhden", postleitzahl: "31711", amtsgericht: "AG Bückeburg", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2 (APW Herford)", startKm: 280.811, endKm: 281, landkreis: "LK Schaumburg", gemarkung: "Rinteln, Stadt", postleitzahl: "31737", amtsgericht: "AG Bückeburg", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2 (APW Herford)", startKm: 281.001, endKm: 281.67, landkreis: "LK Schaumburg", gemarkung: "Luhden", postleitzahl: "31711", amtsgericht: "AG Bückeburg", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2 (APW Herford)", startKm: 281.671, endKm: 283.732, landkreis: "LK Schaumburg", gemarkung: "Rinteln, Stadt", postleitzahl: "31737", amtsgericht: "AG Bückeburg", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2 (APW Herford)", startKm: 283.733, endKm: 296, landkreis: "LK Minden (NRW)", gemarkung: "Porta Westfalica (NRW)", postleitzahl: "32457", amtsgericht: "AG Minden (NRW)", staatsanwaltschaft: "StA Bielefeld (NRW)" },
   { autobahn: "A2 (nur PP RF B)", startKm: 250.5, endKm: 250.5, landkreis: "Region Hannover", gemarkung: "Barsinghausen", postleitzahl: "30890", amtsgericht: "AG Wennigsen", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2 (nur PP RF B)", startKm: 262.8, endKm: 262.8, landkreis: "LK Schaumburg", gemarkung: "Pohle", postleitzahl: "31867", amtsgericht: "AG Stadthagen", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2 (nur RF B)", startKm: 233.741, endKm: 233.8, landkreis: "LH Hannover", gemarkung: "Hannover (Stöcken)", postleitzahl: "30419", amtsgericht: "AG Hannover ", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2 (nur RF B)", startKm: 244.571, endKm: 244.6, landkreis: "Region Hannover", gemarkung: "Barsinghausen", postleitzahl: "30890", amtsgericht: "AG Wennigsen", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2 (nur RF B)", startKm: 253.051, endKm: 253.1, landkreis: "Region Hannover", gemarkung: "Barsinghausen", postleitzahl: "30890", amtsgericht: "AG Wennigsen", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2 (nur RF B)", startKm: 277.131, endKm: 277.2, landkreis: "LK Schaumburg", gemarkung: "Rinteln, Stadt", postleitzahl: "31737", amtsgericht: "AG Rinteln", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2 (nur RF B)", startKm: 278.631, endKm: 278.66, landkreis: "LK Schaumburg", gemarkung: "Rinteln, Stadt", postleitzahl: "31737", amtsgericht: "AG Rinteln", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2 (nur RF DO)", startKm: 233.741, endKm: 233.8, landkreis: "Region Hannover", gemarkung: "Garbsen", postleitzahl: "30823", amtsgericht: "AG Neustadt", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2 (nur RF DO)", startKm: 244.571, endKm: 244.6, landkreis: "Region Hannover", gemarkung: "Wunstorf", postleitzahl: "31515", amtsgericht: "AG Neustadt", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A2 (nur RF DO)", startKm: 253.051, endKm: 253.1, landkreis: "LK Schaumburg", gemarkung: "Bad Nenndorf", postleitzahl: "31542", amtsgericht: "AG Stadthagen", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2 (nur RF DO)", startKm: 277.131, endKm: 277.2, landkreis: "LK Schaumburg", gemarkung: "Buchholz", postleitzahl: "31710", amtsgericht: "AG Rinteln", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2 (nur RF DO)", startKm: 278.631, endKm: 278.66, landkreis: "LK Schaumburg", gemarkung: "Heeßen", postleitzahl: "31707", amtsgericht: "AG Bückeburg", staatsanwaltschaft: "StA Bückeburg" },
   { autobahn: "A2 (PK BAB Braunschweig)", startKm: 195.41, endKm: 197.299, landkreis: "Region Hannover", gemarkung: "Lehrte ", postleitzahl: "31275", amtsgericht: "AG Lehrte ", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A2 (PK BAB Braunschweig)", startKm: 171.311, endKm: 176.2, landkreis: "LK Gifhorn", gemarkung: "Schwu¨lper ", postleitzahl: "38179", amtsgericht: "AG Gifhorn", staatsanwaltschaft: "StA Braunschweig" },
   { autobahn: "A2 (PK BAB Braunschweig)", startKm: 176.201, endKm: 184.23, landkreis: "LK Peine", gemarkung: "Wendeburg ", postleitzahl: "38176", amtsgericht: "AG Gifhorn", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A2 (PK BAB Braunschweig)", startKm: 184.231, endKm: 193.35, landkreis: "LK Peine", gemarkung: "Peine ", postleitzahl: "31228", amtsgericht: "AG Peine", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A2 (PK BAB Braunschweig)", startKm: 193.351, endKm: 193.47, landkreis: "LK Peine", gemarkung: "Edemissen ", postleitzahl: "31234", amtsgericht: "AG Peine", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A2 (PK BAB Braunschweig)", startKm: 193.471, endKm: 195.4, landkreis: "LK Peine", gemarkung: "Peine ", postleitzahl: "31228", amtsgericht: "AG Peine", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A352", startKm: 0, endKm: 0.5, landkreis: "Region Hannover", gemarkung: "Wedemark", postleitzahl: "30900", amtsgericht: "AG Burgwedel", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A352", startKm: 0.501, endKm: 1.23, landkreis: "Region Hannover", gemarkung: "Burgwedel", postleitzahl: "30938", amtsgericht: "AG Burgwedel", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A352", startKm: 1.231, endKm: 5.01, landkreis: "Region Hannover", gemarkung: "Wedemark", postleitzahl: "30900", amtsgericht: "AG Burgwedel", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A352", startKm: 5.011, endKm: 16.75, landkreis: "Region Hannover", gemarkung: "Langenhagen", postleitzahl: "30855", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A352", startKm: 16.751, endKm: 17.75, landkreis: "LH Hannover", gemarkung: "Hannover (Stöcken)", postleitzahl: "30419", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A37", startKm: 0, endKm: 1.65, landkreis: "Region Hannover", gemarkung: "Sehnde", postleitzahl: "31319", amtsgericht: "AG Lehrte", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A37", startKm: 1.651, endKm: 4.63, landkreis: "Region Hannover", gemarkung: "Laatzen", postleitzahl: "30880", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A37", startKm: 18.561, endKm: 21.743, landkreis: "LH Hannover", gemarkung: "Hannover (Lahe)", postleitzahl: "30659", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A37", startKm: 21.744, endKm: 25.963, landkreis: "Region Hannover", gemarkung: "Isernhagen", postleitzahl: "30916", amtsgericht: "AG Burgwedel", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A37", startKm: 25.964, endKm: 27.365, landkreis: "Region Hannover", gemarkung: "Burgdorf Kr Hannover", postleitzahl: "31303", amtsgericht: "AG Burgdorf", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A37/MSW", startKm: 17.8, endKm: 18, landkreis: "LH Hannover", gemarkung: "Hannover (Groß-Buchholz)", postleitzahl: "30655", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A37/MSW (RF Norden)", startKm: 18.001, endKm: 18.56, landkreis: "LH Hannover", gemarkung: "Hannover (Groß-Buchholz)", postleitzahl: "30655", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A37/MSW (RF Süden)", startKm: 18.001, endKm: 18.56, landkreis: "LH Hannover", gemarkung: "Hannover (Lahe)", postleitzahl: "30659", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A7", startKm: 116, endKm: 125.17, landkreis: "Region Hannover", gemarkung: "Wedemark", postleitzahl: "30900", amtsgericht: "AG Burgwedel", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A7", startKm: 125.171, endKm: 132.59, landkreis: "Region Hannover", gemarkung: "Burgwedel", postleitzahl: "30938", amtsgericht: "AG Burgwedel", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A7", startKm: 132.591, endKm: 139.96, landkreis: "Region Hannover", gemarkung: "Isernhagen", postleitzahl: "30916", amtsgericht: "AG Burgwedel", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A7", startKm: 139.961, endKm: 140.7, landkreis: "Region Hannover", gemarkung: "Sehnde", postleitzahl: "31275", amtsgericht: "AG Lehrte", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A7", startKm: 140.701, endKm: 142.12, landkreis: "LH Hannover", gemarkung: "Hannover (Misburg-Nord)", postleitzahl: "30629", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A7", startKm: 142.121, endKm: 153.814, landkreis: "Region Hannover", gemarkung: "Lehrte", postleitzahl: "31275", amtsgericht: "AG Lehrte", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A7", startKm: 153.815, endKm: 155.076, landkreis: "LH Hannover", gemarkung: "Hannover (Anderten)", postleitzahl: "30559", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A7", startKm: 155.077, endKm: 156.498, landkreis: "Region Hannover", gemarkung: "Sehnde", postleitzahl: "31319", amtsgericht: "AG Lehrte", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A7", startKm: 156.499, endKm: 156.85, landkreis: "LH Hannover", gemarkung: "Hannover (Anderten)", postleitzahl: "30559", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A7", startKm: 156.851, endKm: 159.32, landkreis: "LH Hannover", gemarkung: "Hannover (Wülferode)", postleitzahl: "30539", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A7", startKm: 159.321, endKm: 160.37, landkreis: "Region Hannover", gemarkung: "Sehnde", postleitzahl: "31319", amtsgericht: "AG Lehrte", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A7", startKm: 160.371, endKm: 160.595, landkreis: "LH Hannover", gemarkung: "Hannover (Wülferode)", postleitzahl: "30539", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A7", startKm: 160.596, endKm: 162, landkreis: "Region Hannover", gemarkung: "Laatzen", postleitzahl: "30880", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A7", startKm: 162.001, endKm: 162.5, landkreis: "Region Hannover", gemarkung: "Sehnde", postleitzahl: "31319", amtsgericht: "AG Lehrte", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A7 (ESD BAB Hildesheim)", startKm: 162.501, endKm: 164.8, landkreis: "Region Hannover", gemarkung: "Sehnde", postleitzahl: "31319", amtsgericht: "AG Lehrte", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A7 (ESD BAB Hildesheim)", startKm: 164.801, endKm: 166.07, landkreis: "Region Hannover", gemarkung: "Laatzen", postleitzahl: "30880", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "A7 (ESD BAB Hildesheim)", startKm: 166.071, endKm: 167.8, landkreis: "LK Hildesheim", gemarkung: "Sarstedt", postleitzahl: "31157", amtsgericht: "AG Hildesheim", staatsanwaltschaft: "StA Hildesheim" },
   { autobahn: "A7 (PK Bad Fallingbostel)", startKm: 74.477, endKm: 89.41, landkreis: "LK Heidekreis", gemarkung: "Bad Fallingbostel", postleitzahl: "29683", amtsgericht: "AG Walsrode", staatsanwaltschaft: "StA Verden" },
   { autobahn: "A7 (PK Bad Fallingbostel)", startKm: 89.411, endKm: 102.3, landkreis: "LK Heidekreis", gemarkung: "Walsrode", postleitzahl: "29664", amtsgericht: "AG Walsrode", staatsanwaltschaft: "StA Verden" },
   { autobahn: "A7 (PK Bad Fallingbostel)", startKm: 102.301, endKm: 107.05, landkreis: "LK Heidekreis", gemarkung: "Essel", postleitzahl: "29690", amtsgericht: "AG Walsrode", staatsanwaltschaft: "StA Verden" },
   { autobahn: "A7 (PK Bad Fallingbostel)", startKm: 107.051, endKm: 113.024, landkreis: "LK Heidekreis", gemarkung: "Buchholz (Aller)", postleitzahl: "29690", amtsgericht: "AG Walsrode", staatsanwaltschaft: "StA Verden" },
   { autobahn: "A7 (PK Bad Fallingbostel)", startKm: 113.025, endKm: 115.999, landkreis: "Region Hannover", gemarkung: "Wedemark", postleitzahl: "30900", amtsgericht: "AG Burgwedel", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "B3/MSW (Bereich Eilenriede/Weidetor/Misburg)", startKm: 0, endKm: 0.18, landkreis: "LH Hannover", gemarkung: "Hannover (Zoo)", postleitzahl: "30175", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "B3/MSW (Bereich Eilenriede/Weidetor/Misburg)", startKm: 0.181, endKm: 0.51, landkreis: "LH Hannover", gemarkung: "Hannover (Zoo)", postleitzahl: "30625", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "B3/MSW (Bereich Eilenriede/Weidetor/Misburg)", startKm: 0.511, endKm: 3.257, landkreis: "LH Hannover", gemarkung: "Hannover (Groß-Buchholz)", postleitzahl: "30655", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "B3/MSW (Bereich Seelhorst/Pferdeturm/Eilenriede)", startKm: 0, endKm: 0.4, landkreis: "LH Hannover", gemarkung: "Hannover (Seelhorst)", postleitzahl: "30519", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "B3/MSW (Bereich Seelhorst/Pferdeturm/Eilenriede)", startKm: 0.401, endKm: 0.7, landkreis: "LH Hannover", gemarkung: "Hannover (Bemerode)", postleitzahl: "30539", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "B3/MSW (Bereich Seelhorst/Pferdeturm/Eilenriede)", startKm: 0.701, endKm: 1.29, landkreis: "LH Hannover", gemarkung: "Hannover (Waldheim)", postleitzahl: "30519", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "B3/MSW (Bereich Seelhorst/Pferdeturm/Eilenriede)", startKm: 1.291, endKm: 2.55, landkreis: "LH Hannover", gemarkung: "Hannover (Bult)", postleitzahl: "30173", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "B3/MSW (Bereich Seelhorst/Pferdeturm/Eilenriede)", startKm: 2.551, endKm: 4.474, landkreis: "LH Hannover", gemarkung: "Hannover (Zoo)", postleitzahl: "30175", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "B6/MSW", startKm: 4.484, endKm: 6.7, landkreis: "LH Hannover", gemarkung: "Hannover (Seelhorst)", postleitzahl: "30519", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "B6/MSW", startKm: 6.701, endKm: 8.6, landkreis: "LH Hannover", gemarkung: "Hannover (Mittelfeld)", postleitzahl: "30539", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" },
   { autobahn: "B6/MSW", startKm: 8.601, endKm: 10.02, landkreis: "Region Hannover", gemarkung: "Laatzen", postleitzahl: "30880", amtsgericht: "AG Hannover", staatsanwaltschaft: "StA Hannover" }
        ];

        // DATENSTRUKTUR: Liste der Autobahnobjekte mit Kilometrierung
        let objekte = [
   { name: "AS Hämelerwald (Nr. 51)", autobahn: "A2", km: 197.29 },
   { name: "AS Lehrte-Ost (Nr. 50)", autobahn: "A2", km: 204.8 },
   { name: "T+R Lehrter See Süd (RF B)", autobahn: "A2", km: 206.05 },
   { name: "T+R Lehrter See Nord (RF DO)", autobahn: "A2", km: 206.4 },
   { name: "AS Lehrte (Nr. 49)", autobahn: "A2", km: 208.6 },
   { name: "AK Kreuz Hannover-Ost, HKO (Nr. 48)", autobahn: "A2", km: 213 },
   { name: "AK Kreuz Hannover-Buchholz (Nr. 47)", autobahn: "A2", km: 217 },
   { name: "AS Hannover-Lahe (Nr. 46)", autobahn: "A2", km: 218.1 },
   { name: "PP Varrelheide", autobahn: "A2", km: 219.5 },
   { name: "AS Hannover-Bothfeld (Nr. 45)", autobahn: "A2", km: 222.6 },
   { name: "PP Vahrenheide", autobahn: "A2", km: 224 },
   { name: "AS Langenhagen (Nr. 44)", autobahn: "A2", km: 225.5 },
   { name: "PP Godshorn", autobahn: "A2", km: 228 },
   { name: "AD Dreieck Hannover-West (Nr. 43)", autobahn: "A2", km: 230.1 },
   { name: "AS Hannover-Nordhafen", autobahn: "A2", km: 231.45 },
   { name: "AS Hannover-Herrenhausen (Nr. 42)", autobahn: "A2", km: 232.6 },
   { name: "AS Garbsen (Nr. 41)", autobahn: "A2", km: 236.57 },
   { name: "T+R Garbsen-Süd (RF B)", autobahn: "A2", km: 237.21 },
   { name: "T+R Garbsen-Nord (RF DO)", autobahn: "A2", km: 237.92 },
   { name: "AS Wunstorf-Luthe (Nr. 40)", autobahn: "A2", km: 241 },
   { name: "AS Wunstorf-Kolenfeld (Nr. 39)", autobahn: "A2", km: 244.6 },
   { name: "PP Bückethaler Knick", autobahn: "A2", km: 250.5 },
   { name: "AS Bad Nenndorf (Nr. 38)", autobahn: "A2", km: 252.3 },
   { name: "AS Lauenau (Nr. 37)", autobahn: "A2", km: 259.6 },
   { name: "PP Schafstrift (RF B)", autobahn: "A2", km: 262.8 },
   { name: "PP Schafstrift (RF DO)", autobahn: "A2", km: 263.35 },
   { name: "AS Rehren (Nr. 36)", autobahn: "A2", km: 268.7 },
   { name: "T+R Auetal", autobahn: "A2", km: 270 },
   { name: "PP Bernser Kirchweg", autobahn: "A2", km: 274.5 },
   { name: "AS Bad Eilsen-Ost (Nr. 35)", autobahn: "A2", km: 277.6 },
   { name: "AS Bad Eilsen (Nr. 35)", autobahn: "A2", km: 278.8 },
   { name: "PP Papenbrink", autobahn: "A2", km: 282.5 },
   { name: "AD Dreieck Hannover-Nord (Nr. 1)", autobahn: "A352", km: 0 },
   { name: "PP Bissendorf (RF HH)", autobahn: "A352", km: 4.1 },
   { name: "PP Bissendorf (RF DO)", autobahn: "A352", km: 5 },
   { name: "AS Langenhagen-Kaltenweide (Nr. 2)", autobahn: "A352", km: 7.6 },
   { name: "AS Flughafen (Nr. 3)", autobahn: "A352", km: 11.49 },
   { name: "Abzweig Flughafenstraße/B522 (Nr. 3)", autobahn: "A352", km: 12.57 },
   { name: "AS Engelbostel (Nr. 4)", autobahn: "A352", km: 15.9 },
   { name: "AD Dreieck Hannover-West (Nr. 5)", autobahn: "A352", km: 17.5 },
   { name: "AD Dreieck Hannover-Süd (Nr. 12)", autobahn: "A37", km: 0 },
   { name: "AK Kreuz Hannover-Kirchhorst (Nr. 3)", autobahn: "A37", km: 23.1 },
   { name: "AS Beinhorn (Nr. 2)", autobahn: "A37", km: 27.14 },
   { name: "Abzweig B6/Messestutzen/Dreieck Laatzen (Nr. 11)", autobahn: "A37/MSW", km: 4.63 },
   { name: "AS Hannover-Misburg (Nr. 5)", autobahn: "A37/MSW", km: 18 },
   { name: "AK Kreuz Hannover-Buchholz (Nr. 4)", autobahn: "A37/MSW", km: 19.8 },
   { name: "AS Berkhof (Nr. 51)", autobahn: "A7", km: 116 },
   { name: "PP Osterriehe", autobahn: "A7", km: 120.65 },
   { name: "PP Up'n Bummelskampe", autobahn: "A7", km: 120.65 },
   { name: "AS Mellendorf (Nr. 52)", autobahn: "A7", km: 122.9 },
   { name: "AD Dreieck Hannover-Nord (Nr. 53)", autobahn: "A7", km: 124.7 },
   { name: "PP Springhorst", autobahn: "A7", km: 129.15 },
   { name: "PP Seckbruch", autobahn: "A7", km: 129.39 },
   { name: "AS Großburgwedel (Nr. 54)", autobahn: "A7", km: 131.08 },
   { name: "AS Altwarmbüchen (Nr. 56)", autobahn: "A7", km: 137.94 },
   { name: "AK Kreuz Hannover-Kirchhorst (Nr. 56)", autobahn: "A7", km: 138.98 },
   { name: "PP Altwarmbüchener Moor", autobahn: "A7", km: 141.04 },
   { name: "AK Kreuz Hannover-Ost, HKO (Nr. 57)", autobahn: "A7", km: 142.48 },
   { name: "AS Hannover-Anderten (Nr. 58)", autobahn: "A7", km: 155 },
   { name: "T+R Wülferode-West (RF KS)", autobahn: "A7", km: 157.3 },
   { name: "T+R Wülferode-Ost (RF HH)", autobahn: "A7", km: 158.5 },
   { name: "AS Laatzen (Nr. 59)", autobahn: "A7", km: 161 },
   { name: "AD Dreieck Hannover-Süd (Nr. 60)", autobahn: "A7", km: 161.66 },
   { name: "AS Hannover-Misburg", autobahn: "B3/MSW", km: 3.257 },
   { name: "AS Weidetor", autobahn: "B3/MSW", km: 0.94 },
   { name: "AS Pferdeturm", autobahn: "B3/MSW", km: 2.55 },
   { name: "AS Bischofshol", autobahn: "B3/MSW", km: 1.5 },
   { name: "AS Zuschlagstraße/Bult", autobahn: "B3/MSW", km: 0.7 },
   { name: "AK Kreuz Seelhorst", autobahn: "B3/MSW", km: 0 },
   { name: "AK Kreuz Seelhorst", autobahn: "B6/MSW", km: 4.484 },
   { name: "AS Messe-Nord", autobahn: "B6/MSW", km: 7 },
   { name: "Tankstellen ARAL Messe beide RF", autobahn: "B6/MSW", km: 8 },
   { name: "AS Messe-Süd/Kronsberg", autobahn: "B6/MSW", km: 8.49 }
        ];
        
        // DOM-Element-Referenzen (Deutsch)
        const statusNachrichtEl = document.getElementById('statusMessage');
        const ergebnisseContainerEl = document.getElementById('resultsContainer');
        const suchButton = document.getElementById('searchButton');
        const kilometerEingabe = document.getElementById('kilometerInput');
        const inputLabelEl = document.getElementById('inputLabel');
        // Neue Referenzen für den Umschalter
        const modusKmEl = document.getElementById('modusKm');
        const modusNameEl = document.getElementById('modusName');
        // NEUE REFERENZEN UND KONSTANTEN FÜR DEN IOS ZOOM FIX
        const viewportMeta = document.getElementById('viewportMeta');
        const initialViewportContent = viewportMeta ? viewportMeta.content : 'width=device-width, initial-scale=1.0';


        function getCurrentModus() {
            const checkedRadio = document.querySelector('input[name="suchModus"]:checked');
            return checkedRadio ? checkedRadio.value : 'kilometer'; // Fallback auf Kilometer
        }

        function zeigeStatus(nachricht, typ = 'info') {
            statusNachrichtEl.textContent = nachricht;
            statusNachrichtEl.className = 'status-message';

            if (typ === 'info') {
                statusNachrichtEl.classList.add('status-info');
            } else if (typ === 'error') {
                statusNachrichtEl.classList.add('status-error');
            } else if (typ === 'success') {
                statusNachrichtEl.classList.add('status-success');
            }
        }

        // === Initialisierung ===
        // Sortiere die Daten einmalig beim Laden (optimiert die Suche)
        kilometerBereiche.sort((a, b) => a.startKm - b.startKm);
        suchButton.disabled = false;
        zeigeStatus(`Daten für ${kilometerBereiche.length} Streckenbereiche und ${objekte.length} Namensobjekte geladen. Die Anwendung ist bereit.`, 'success');
        
        // === Suchlogik-Funktionen (Deutsch) ===

        function normalisiereKilometer(eingabe) {
            // Ersetze Komma durch Punkt und konvertiere in eine Zahl
            const normalisiert = eingabe.replace(',', '.');
            return parseFloat(normalisiert);
        }

        /**
         * Findet ALLE passenden Bereiche für den gegebenen Kilometerwert.
         * @param {number} kmWert - Der normalisierte Kilometerwert.
         * @returns {Array} - Ein Array aller passenden Bereiche.
         */
        function findePassendeBereicheNachKilometer(kmWert) {
            return kilometerBereiche.filter(bereich => {
                // Die Suchlogik: Der Kilometer muss >= Start und <= Ende sein
                return kmWert >= bereich.startKm && kmWert <= bereich.endKm;
            });
        }
        
        /**
         * Findet ALLE objekte, die dem Suchbegriff entsprechen.
         * @param {string} objektName - Der gesuchte Name der Ausfahrt (Teilstringsuche).
         * @returns {Array} - Ein Array passender Ausfahrts-Objekte.
         */
        function findeObjekt(objektName) {
            const suchWert = objektName.trim().toLowerCase();
            if (!suchWert) return [];
            
            return objekte.filter(objekte => {
                // Case-insensitive Teilstringsuche im objektNamen
                const objektNameKlein = (objekte.name || '').toLowerCase();
                return objektNameKlein.includes(suchWert);
            });
        }


        /**
         * Erstellt und zeigt alle gefundenen Ergebnisse dynamisch an.
         * @param {Array} ergebnisse - Ein Array von Trefferobjekten.
         * @param {Object | null} originalSuche - Das Ausfahrts-Objekt, falls über Ausfahrt gesucht wurde.
         */
        function zeigeErgebnisse(ergebnisse, originalSuche = null) {
            // Leere den Container vor dem Hinzufügen neuer Ergebnisse
            ergebnisseContainerEl.innerHTML = '<h2 class="results-container-title">Gefundene Treffer:</h2>';

            if (ergebnisse.length > 0) {
                ergebnisse.forEach((ergebnis, index) => {
                    const startStr = ergebnis.startKm.toFixed(3).replace('.', ',');
                    const endeStr = ergebnis.endKm.toFixed(3).replace('.', ',');
                    
                    const karte = document.createElement('div');
                    const borderColorClass = ergebnisse.length > 1 ? 'border-yellow' : 'border-green';

                    karte.className = `ergebnis-karte ${borderColorClass}`;
                    
                    // Optionaler Hinweis, wenn über objekt gesucht wurde
                    let objektHinweis = '';
                    // originalSuche ist nur gesetzt, wenn genau eine objekt als Suchbegriff gefunden wurde.
                    // Wenn über Streckenkilometer gesucht wird, ist originalSuche null.
                    // Wenn der objekts-Modus läuft, hat das Ergebnis-Objekt eine 'originalObjekt' Eigenschaft.
                    if (ergebnis.originalObjekt) {
                         const objekt = ergebnis.originalObjekt;
                         const kilometerobjektStr = objekt.km.toFixed(3).replace('.', ',');
                         objektHinweis = `<p class="objekt-info">Kilometerbereich entnommen von Objekt: ${objekt.name} (km ${kilometerobjektStr})</p>`;
                    }

                    // Füge den HTML-Inhalt der Karte hinzu
                    karte.innerHTML = `
                        <h3 class="ergebnis-karte-title">Treffer ${index + 1}</h3>
                        <div class="ergebnis-detail">
                            <span class="detail-label">Autobahn:</span>
                            <span class="detail-value">${ergebnis.autobahn || 'N/A'}</span>
                        </div>
                        <div class="ergebnis-detail">
                            <span class="detail-label">Landkreis:</span>
                            <span class="detail-value">${ergebnis.landkreis || 'N/A'}</span>
                        </div>
                        <div class="ergebnis-detail">
                            <span class="detail-label">Gemarkung:</span>
                            <span class="detail-value">${ergebnis.gemarkung || 'N/A'}</span>
                        </div>
                        <div class="ergebnis-detail">
                            <span class="detail-label">Postleitzahl:</span>
                            <span class="detail-value">${ergebnis.postleitzahl || 'N/A'}</span>
                        </div>
                        <div class="ergebnis-detail">
                            <span class="detail-label">Amtsgericht:</span>
                            <span class="detail-value">${ergebnis.amtsgericht || 'N/A'}</span>
                        </div>
                        <div class="ergebnis-detail">
                            <span class="detail-label">Staatsanwaltschaft:</span>
                            <span class="detail-value">${ergebnis.staatsanwaltschaft || 'N/A'}</span>
                        </div>
                        ${objektHinweis}
                        <p class="bereich-info">Kilometerbereich: ${startStr} - ${endeStr}</p>
                    `;
                    ergebnisseContainerEl.appendChild(karte);
                });

                ergebnisseContainerEl.style.display = 'flex';
                zeigeStatus(`${ergebnisse.length} Treffer gefunden.`, 'success');

            } else {
                // Kein Treffer
                ergebnisseContainerEl.style.display = 'none';
                zeigeStatus('Kein Eintrag gefunden.', 'info');
            }
        }



        /**
         * Führt den iOS-Zoom-Workaround aus, um die Seite nach dem Ausblenden der Tastatur 
         * auf den normalen Zoom zurückzusetzen.
         */
        function resetMobileZoom() {
            // Check, ob es sich um ein iOS-Gerät handelt (optional, aber gut für Performance)
                // Setze max-scale temporär auf 1.0
                viewportMeta.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0';
                
                // Setze nach kurzer Zeit den ursprünglichen Zustand zurück
                setTimeout(() => {
                    viewportMeta.content = initialViewportContent;
                }, 50); // Eine kurze Verzögerung von 50ms ist ausreichend
        }



        function fuehreSucheAus() {
            const modus = getCurrentModus();
            const eingabe = kilometerEingabe.value.trim();
                        // NEU: Tastatur ausblenden, um ungewolltes Zoomen auf iOS nach dem Absenden zu beheben
            kilometerEingabe.blur();
            ergebnisseContainerEl.style.display = 'none';
            let trefferArray = [];
            
            if (!eingabe) {
                zeigeStatus('Bitte geben Sie einen Suchwert ein.', 'info');
                return;
            }
            
            // --- Modus: Streckenkilometer ---
            if (modus === 'kilometer') {
                const kmWert = normalisiereKilometer(eingabe);
                if (isNaN(kmWert)) {
                    zeigeStatus('Ungültige Kilometereingabe. Bitte geben Sie eine Zahl ein.', 'error');
                    return;
                }
                zeigeStatus(`Suche nach Kilometer ${kmWert.toFixed(3).replace('.', ',')}...`, 'info');
                trefferArray = findePassendeBereicheNachKilometer(kmWert);
                zeigeErgebnisse(trefferArray);

            // --- Modus: objektName ---
            } else if (modus === 'name') {
                const gefundeneobjekte = findeObjekt(eingabe);
                
                if (gefundeneobjekte.length === 0) {
                    zeigeStatus(`Kein Objekt mit dem Namen "${eingabe}" gefunden.`, 'error');
                    return;
                }

                zeigeStatus(`${gefundeneobjekte.length} Objekt(e) mit dem Namen "${eingabe}" gefunden. Suche zugehörige Streckenbereiche...`, 'info');
                
                // Wir sammeln alle Streckenbereiche, die zu den gefundenen objekte gehören
                let alleBereiche = [];
                
                gefundeneobjekte.forEach(objekte => {
                    const kmWert = objekte.km;
                    const bereiche = findePassendeBereicheNachKilometer(kmWert);
                    
                    bereiche.forEach(bereich => {
                        if (!alleBereiche.some(b => b.autobahn === bereich.autobahn && b.startKm === bereich.startKm && b.endKm === bereich.endKm)) {
                             alleBereiche.push(Object.assign({}, bereich, {
                                originalObjekt: objekte
                            }));
                        }
                    });
                });

                // Rufe zeigeErgebnisse auf, um die gefundenen Streckenbereiche anzuzeigen.
                // originalSuche ist hier null, da die Anzeige der Ausfahrt über das ergebnis.originalObjekt-Feld läuft.
                zeigeErgebnisse(alleBereiche, null);
            }
        }
        
        // === UI-Anpassung bei Moduswechsel ===
        function aktualisiereUI() {
            const modus = getCurrentModus();
            if (modus === 'kilometer') {
                inputLabelEl.textContent = 'Betriebskilometer eingeben';
                kilometerEingabe.placeholder = '(z.B. 237,920)';
                                kilometerEingabe.type = 'number'; 
kilometerEingabe.setAttribute('pattern', '[0-9,.]*'); 
            } else if (modus === 'name') {
                inputLabelEl.textContent = 'Name des Objektes eingeben';
                kilometerEingabe.placeholder = '(z.B. Bückethaler Knick)';
kilometerEingabe.type = 'text'; 
kilometerEingabe.removeAttribute('pattern');            }
            // Status und Ergebnisse zurücksetzen
            // zeigeStatus(`Suchmodus auf '${modus}' eingestellt.`, 'info');
            ergebnisseContainerEl.style.display = 'none';
            kilometerEingabe.value = '';
        }

        // === Event Listener (Deutsch) ===
        suchButton.addEventListener('click', fuehreSucheAus);
        kilometerEingabe.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                fuehreSucheAus();
            }
        });
        // Listener für den Moduswechsel am Radio-Button-Container
        modusKmEl.addEventListener('change', aktualisiereUI);
        modusNameEl.addEventListener('change', aktualisiereUI);
        
        // Initialen UI-Zustand festlegen
        aktualisiereUI();

    </script>
            <script>
        // Skript für den Dark Mode
        const themeSwitcher = document.getElementById('themeSwitcher');
        const body = document.body;

        function applyTheme(preference) {
            let effectiveTheme = (preference === 'auto')
                ? (new Date().getHours() >= 20 || new Date().getHours() < 6 ? 'dark' : 'light')
                : preference;
            
            body.classList.toggle('dark-mode', effectiveTheme === 'dark');
        }

        themeSwitcher.addEventListener('change', () => {
            localStorage.setItem('themePreference', themeSwitcher.value);
            applyTheme(themeSwitcher.value);
        });

        document.addEventListener('DOMContentLoaded', () => {
            const savedPreference = localStorage.getItem('themePreference') || 'auto';
            themeSwitcher.value = savedPreference;
            applyTheme(savedPreference);
        });
    </script>
</body>
</html>

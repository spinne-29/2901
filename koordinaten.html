<!-- 

Eine Erweiterung für


             000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000             
          0000000                                                                                                       0000000          
        00000                                                                                                               00000        
      0000                                                                                                                     0000      
    0000                                                                                                                         0000    
   0000                                                                                                                           0000   
  000                                                                                                                              0000  
 000                                                                                                                                 000 
000                                                                                                                                  0000
000                       0000                                                                                                        000
00                      00     00       0000000000000000000000000000000000000000000000                                                 00
00                      0         00    00000000000000000000000000000000000000000000000000                                             00
00                      0            00000000000000000000000000000000000000000000000000000000                                          00
00                       00             0000000000000000000000000000000000000000000000000000000                                        00
00                          000             00000000000000000000000000000000000000000000000000000                                      00
00                             000             0000000000000000000000     0000000000000000000000000                                    00
00                                 00            000000000000  0000000  0000000000000000000000000000                                   00
00                                    00           000     000000000 00000000000000000000000000000000                                  00
00                                      000          000 000000000 00000000000000000000000000000000000                                 00
00                                       00000000    0 0000000000            00000000000000000000000000                                00
00                                     0000000000000 00000000000                  000000000000000000000                                00
00                                   00000000000000000000000000                     00000000000000000000                               00
00                                  00000000000000000000000000                       0000000000000000000                               00
00                                 00000000000000000000000000 000000000000            000000000000000000                               00
00                                00000000000000000000000000 0000000000000            000000000000000000                               00
00                               000000000000000000000000000 0000000000000 000000     000000000000000000                               00
00                               00000000000000000000000000 00000000000000 00000000   000000000000000000   0                           00
00                              000000000000000000000000000000000000000000 0000000000 000000000000000000   0000000                     00
00                       0000   00000000000000000000000000 000000000000000 00000000000 00000000000000000        00000                  00
00                   0000      000000000000000000000000000 000000000000000 00000000000 0000000000000000           0000                 00
00                 0000        00000000000000000000000000     00000000000000000  00000 0000000000000000          0000                  00
00                 0000                    00000000000000 0000000000000000000 0000 000 000000000000000       000000                    00
00                   000000             00000000  0000000 0000                0000  00000000000000000000000000                         00
00                       000000000000   000000000000000000000000000000000000000000000000000         0000                               00
00                              00000000              000000000000000                   00000000000                                    00
00                                      0000000000000000000000000000000000000000000000000000000000                                     00
00                                      000000000000000000000000000000000000000000000000000000000                                      00
00                                      0000000000000000000000000000000000000000000000000000000                                        00
00                                      0000000000000000000000000000000000000000000000000000                                           00
00                                      0000000000000000000000000000000000000000000000000                                              00
00                                      000000000000000000000000000000000000000000000                                                  00
00                                      0000000000000000000                                                                            00
00                                      0000000000000000000                                                                            00
00                                      0000000000000000000                                                                            00
00                                      0000000000000000000                                                                            00
00                                      0000000000000000000                                                                            00
00                                      0000000000000000000                                                                            00
00                                      0000000000000000000                                                                            00
00                                      0000000000000000000                                                                            00
00                                      0000000000000000000                                                                            00
00                                      0000000000000000000                                                                            00
00                                      0000000000000000000                                                                            00
00                                                                                                                                     00
00                                                                                                                                     00
00                                                                                                                                     00
00                                                                                                                                     00
00                                0000000    000            00       000      00    00000000 00000000000                               00
00                                000000000  000           0000      00000    00    00000000 00000000000                               00
00                                000   000  000          00 000     000000   00    00           000                                   00
00                                000   000  000         000  00     000 000  00    0000000      000                                   00
00                                00000000   000        000   000    000  000 00    0000000      000                                   00
00                                000        000        0000000000   000   00000    00           000                                   00
00                                000        000       000      000  000    0000    00           000                                   00
00                                000        00000000 000        000 000     000    00000000     000                                   00
00                                                                                                                                    000
000                                                                                                                                   000
0000                                                                                                                                 000 
 0000                                                                                                                               000  
  0000                                                                                                                             000   
   0000                                                                                                                          0000    
     0000                                                                                                                      00000     
       00000                                                                                                                 00000       
         000000                                                                                                           000000         
            000000000                                                                                               000000000            
                000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000                        
          


-->


<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" href="geocop-touch-icon.png"/>
    <title>GIS>NIVADIS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: auto;
        }
        h1 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 25px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="number"], input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background-color 0.2s ease;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result-box, .map-box {
            margin-top: 30px;
            padding: 20px;
            background-color: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 8px;
        }
        .result-box p {
            margin: 5px 0;
            font-size: 1.1em;
        }
        .error {
            color: red;
            margin-top: 10px;
            font-weight: bold;
        }
        iframe {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
                /* --- Dark Mode Styles --- */
        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }
        body.dark-mode .container {
            background-color: #1e1e1e;
            box-shadow: 0 2px 10px rgba(255, 255, 255, 0.1);
        }
        body.dark-mode h1, body.dark-mode h2, body.dark-mode legend {
            color: #58a6ff;
        }
        body.dark-mode label { color: #c9d1d9; }
        body.dark-mode .checkbox-group label { color: #e0e0e0; }
        body.dark-mode input[type="text"],
        body.dark-mode input[type="number"],
        body.dark-mode select {
            background-color: #2c2c2c;
            border-color: #555;
            color: #e0e0e0;
        }
        body.dark-mode input::placeholder { color: #888; }
        body.dark-mode button { background-color: #0056b3; color: #e0e0e0; border: 1px solid #1e1e1e; }
        body.dark-mode button:hover { background-color: #007bff; }
        body.dark-mode #result-1 { background-color: #2a2a2a; border-color: #444; color: #e0e0e0; }
        body.dark-mode #result-2 { background-color: #2a2a2a; border-color: #444; color: #e0e0e0; }
        body.dark-mode #map-box { background-color: #2a2a2a; border-color: #444; color: #e0e0e0; }
        body.dark-mode fieldset {
            border-color: #4a4a4a;
            background-color: rgba(255,255,255,0.02);
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.5/proj4.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Koordinaten-Umwandler</h1>
        <center><button onclick="getLocation()">Eigenen Standort ermitteln</button><br><br></center>
        <div class="input-group">
            <label for="latitude">Breitengrad (z.B. 52.42226) aus Google Maps o.ä.:</label>
            <input type="text" id="latitude" placeholder="Breitengrad (Latitude)">
        </div>
        <div class="input-group">
            <label for="longitude">Längengrad (z.B. 9.56025) aus Google Maps o.ä.:</label>
            <input type="text" id="longitude" placeholder="Längengrad (Longitude)">
        </div>
        <center><button onclick="convertAndShow()">Koordinaten umwandeln</button></center>


        <div class="result-box" id="result-1">
            <p><strong>NIVADIS GIS "Rechts":</strong> <span id="utmEasting">N/A</span></p>
        </div>
        <div class="result-box" id="result-2">
            <p><strong>NIVADIS GIS "Hoch":</strong> <span id="utmNorthing">N/A</span></p>
        </div><br>
        <div id="error-message" class="error"></div>
        <div class="map-box" id="map-box">
            <iframe id="osmMap" src="about:blank" title="OpenStreetMap Viewer"></iframe>
        </div>
        <div style="text-align: center; margin-bottom: 25px;">
        <br>
            <label for="themeSwitcher" style="display: inline-block; width: auto;">Darstellung:</label>
            <select id="themeSwitcher" style="width: 150px; padding: 5px;">
                <option value="light">Hell</option>
                <option value="dark">Dunkel</option>
                <option value="auto">Automatisch</option>
            </select>
        </div>

    </div>

    <script>
        // Definiert das WGS84 (EPSG:4326) Koordinatensystem
        proj4.defs("EPSG:4326", "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs");
        // Funktion zum Aktualisieren der OSM-Karte
        function updateOsmMap(latitude, longitude) {
            const osmMapFrame = document.getElementById('osmMap');
            if (osmMapFrame) {
                const mapUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${longitude}%2C${latitude}%2C${longitude}%2C${latitude}&marker=${latitude},${longitude}`;
                osmMapFrame.src = mapUrl;
            }
        }
        function convertAndShow() {
            const latitude = parseFloat(document.getElementById('latitude').value);
            const longitude = parseFloat(document.getElementById('longitude').value);
            const errorMessage = document.getElementById('error-message');

            errorMessage.textContent = ''; // Fehlermeldung zurücksetzen

            if (isNaN(latitude) || isNaN(longitude) || latitude < -90 || latitude > 90 || longitude < -180 || longitude > 180) {
                errorMessage.textContent = 'Bitte gültige Breiten- und Längengrade eingeben.';
                document.getElementById('utmEasting').textContent = 'N/A';
                document.getElementById('utmNorthing').textContent = 'N/A';
                document.getElementById('osmMap').src = 'about:blank'; // Karte zurücksetzen
                return;
            }

            try {
                const utmZoneNumber = Math.floor((longitude + 180) / 6) + 1;
                const utmHemisphere = latitude >= 0 ? 'N' : 'S';
                const utmProjectionCode = `EPSG:326${utmZoneNumber}`;
                proj4.defs(utmProjectionCode, `+proj=utm +zone=${utmZoneNumber} +datum=WGS84 +units=m +no_defs`);
                const utmCoordinates = proj4("EPSG:4326", utmProjectionCode, [longitude, latitude]);

                document.getElementById('utmEasting').textContent = `${utmZoneNumber}` + utmCoordinates[0].toFixed(0);
                document.getElementById('utmNorthing').textContent = utmCoordinates[1].toFixed(0);

                updateOsmMap(latitude, longitude);

            } catch (e) {
                errorMessage.textContent = 'Fehler bei der Umrechnung: ' + e.message + '. Stellen Sie sicher, dass die Koordinaten gültig sind und die UTM-Zone korrekt abgeleitet werden kann.';
                document.getElementById('utmEasting').textContent = 'N/A';
                document.getElementById('utmNorthing').textContent = 'N/A';
                document.getElementById('osmMap').src = 'about:blank'; // Karte zurücksetzen
            }
        }

        function getLocation() {
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = ''; // Fehlermeldung zurücksetzen

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
                        document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
                        convertAndShow();
                    },
                    (error) => {
                        let msg = '';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                msg = "Zugriff auf den Standort verweigert. Bitte erlauben Sie den Standortzugriff in Ihren Browsereinstellungen.";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                msg = "Standortinformationen sind nicht verfügbar.";
                                break;
                            case error.TIMEOUT:
                                msg = "Die Anfrage zur Standortbestimmung ist abgelaufen (Zeitüberschreitung).";
                                break;
                            case error.UNKNOWN_ERROR:
                                msg = "Ein unbekannter Fehler ist aufgetreten.";
                                break;
                        }
                        errorMessage.textContent = msg;
                        document.getElementById('osmMap').src = 'about:blank'; // Karte zurücksetzen
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            } else {
                errorMessage.textContent = "Ihr Browser unterstützt die Geolocation API nicht.";
                document.getElementById('osmMap').src = 'about:blank'; // Karte zurücksetzen
            }
        }
    </script>
        <script>
        // Skript für den Dark Mode
        const themeSwitcher = document.getElementById('themeSwitcher');
        const body = document.body;

        function applyTheme(preference) {
            let effectiveTheme = (preference === 'auto')
                ? (new Date().getHours() >= 20 || new Date().getHours() < 6 ? 'dark' : 'light')
                : preference;
            
            body.classList.toggle('dark-mode', effectiveTheme === 'dark');
        }

        themeSwitcher.addEventListener('change', () => {
            localStorage.setItem('themePreference', themeSwitcher.value);
            applyTheme(themeSwitcher.value);
        });

        document.addEventListener('DOMContentLoaded', () => {
            const savedPreference = localStorage.getItem('themePreference') || 'auto';
            themeSwitcher.value = savedPreference;
            applyTheme(savedPreference);
        });
    </script>
</body>
</html>


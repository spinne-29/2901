
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIS-Koordinaten</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: auto;
        }
        h1 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 25px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="number"], input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px; /* Added for better spacing */
            transition: background-color 0.2s ease;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result-box, .map-box {
            margin-top: 30px;
            padding: 20px;
            background-color: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 8px;
        }
        .result-box p {
            margin: 5px 0;
            font-size: 1.1em;
        }
        .error {
            color: red;
            margin-top: 10px;
            font-weight: bold;
        }
        iframe {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.5/proj4.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Koordinaten-Umwandler</h1>
        <button onclick="getLocation()">Eigenen Standort ermitteln</button><br><br>
        <div class="input-group">
            <label for="latitude">Breitengrad (z.B. 52.42226) aus Google Maps o.ä.:</label>
            <input type="text" id="latitude" placeholder="Breitengrad (Latitude)">
        </div>
        <div class="input-group">
            <label for="longitude">Längengrad (z.B. 9.56025) aus Google Maps o.ä.:</label>
            <input type="text" id="longitude" placeholder="Längengrad (Longitude)">
        </div>
        <button onclick="convertAndShow()">Koordinaten umwandeln</button>


        <div class="result-box" id="result-1">
            <p><strong>NIVADIS GIS "Rechts":</strong> <span id="utmEasting">N/A</span></p>
        </div>
        <div class="result-box" id="result-2">
            <p><strong>NIVADIS GIS "Hoch":</strong> <span id="utmNorthing">N/A</span></p>
        </div><br>
        <div id="error-message" class="error"></div>
        <div class="map-box">
            <iframe id="osmMap" src="about:blank" title="OpenStreetMap Viewer"></iframe>
        </div>
    </div>

    <script>
        // Definiert das WGS84 (EPSG:4326) Koordinatensystem
        proj4.defs("EPSG:4326", "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs");

        // Funktion zum Aktualisieren der OSM-Karte
        function updateOsmMap(latitude, longitude) {
            const osmMapFrame = document.getElementById('osmMap');
            if (osmMapFrame) {
                // Generischer OSM-Link mit Marker und Zoom. Zoomstufe 15 ist ein guter Standardwert.
                const mapUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${longitude}%2C${latitude}%2C${longitude}%2C${latitude}&marker=${latitude},${longitude}`;
                osmMapFrame.src = mapUrl;
            }
        }

        // Ich habe den Namen der Funktion hier an die vorherige Empfehlung angepasst.
        // Sie kann aber auch "convertCoordinates" heißen, solange der "onclick"
        // in den Buttons ebenfalls angepasst wird.
        function convertAndShow() {
            const latitude = parseFloat(document.getElementById('latitude').value);
            const longitude = parseFloat(document.getElementById('longitude').value);
            const errorMessage = document.getElementById('error-message');

            errorMessage.textContent = ''; // Fehlermeldung zurücksetzen

            if (isNaN(latitude) || isNaN(longitude) || latitude < -90 || latitude > 90 || longitude < -180 || longitude > 180) {
                errorMessage.textContent = 'Bitte gültige Breiten- und Längengrade eingeben.';
                // document.getElementById('utmZone').textContent ist nicht mehr vorhanden in Ihrem aktuellen HTML
                document.getElementById('utmEasting').textContent = 'N/A';
                document.getElementById('utmNorthing').textContent = 'N/A';
                document.getElementById('osmMap').src = 'about:blank'; // Karte zurücksetzen
                return;
            }

            try {
                const utmZoneNumber = Math.floor((longitude + 180) / 6) + 1;
                const utmHemisphere = latitude >= 0 ? 'N' : 'S';
                const utmProjectionCode = `EPSG:326${utmZoneNumber}`; // Für nördliche Hemisphäre (WGS 84 / UTM zone XXN)
                proj4.defs(utmProjectionCode, `+proj=utm +zone=${utmZoneNumber} +datum=WGS84 +units=m +no_defs`);
                const utmCoordinates = proj4("EPSG:4326", utmProjectionCode, [longitude, latitude]);

                document.getElementById('utmEasting').textContent = `${utmZoneNumber}` + utmCoordinates[0].toFixed(0);
                document.getElementById('utmNorthing').textContent = utmCoordinates[1].toFixed(0);

                updateOsmMap(latitude, longitude);

            } catch (e) {
                errorMessage.textContent = 'Fehler bei der Umrechnung: ' + e.message + '. Stellen Sie sicher, dass die Koordinaten gültig sind und die UTM-Zone korrekt abgeleitet werden kann.';
                // document.getElementById('utmZone').textContent = 'N/A'; // Nicht mehr vorhanden
                document.getElementById('utmEasting').textContent = 'N/A';
                document.getElementById('utmNorthing').textContent = 'N/A';
                document.getElementById('osmMap').src = 'about:blank'; // Karte zurücksetzen
            }
        }

        function getLocation() {
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = ''; // Fehlermeldung zurücksetzen

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
                        document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
                        // Rufen Sie die gemeinsame Funktion auf, die UTM umwandelt und die Karte aktualisiert
                        convertAndShow();
                    },
                    (error) => {
                        let msg = '';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                msg = "Zugriff auf den Standort verweigert. Bitte erlauben Sie den Standortzugriff in Ihren Browsereinstellungen.";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                msg = "Standortinformationen sind nicht verfügbar.";
                                break;
                            case error.TIMEOUT:
                                msg = "Die Anfrage zur Standortbestimmung ist abgelaufen (Zeitüberschreitung).";
                                break;
                            case error.UNKNOWN_ERROR:
                                msg = "Ein unbekannter Fehler ist aufgetreten.";
                                break;
                        }
                        errorMessage.textContent = msg;
                        document.getElementById('osmMap').src = 'about:blank'; // Karte zurücksetzen
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            } else {
                errorMessage.textContent = "Ihr Browser unterstützt die Geolocation API nicht.";
                document.getElementById('osmMap').src = 'about:blank'; // Karte zurücksetzen
            }
        }
    </script>
</body>
</html>

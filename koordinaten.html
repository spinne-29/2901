<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koordinaten-Umwandler (Google Maps zu UTM)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: auto;
        }
        h1 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 25px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="number"], input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            transition: background-color 0.2s ease;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result-box {
            margin-top: 30px;
            padding: 20px;
            background-color: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 8px;
        }
        .result-box p {
            margin: 5px 0;
            font-size: 1.1em;
        }
        .error {
            color: red;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.5/proj4.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Koordinaten-Umwandler</h1>
        <button onclick="getLocation()">Eigenen Standort ermitteln</button><br><br>
        <div class="input-group">
            <label for="latitude">Breitengrad (z.B. 52.42226) aus Google Maps o.ä.:</label>
            <input type="text" id="latitude" placeholder="Enter Breitengrad">
        </div>
        <div class="input-group">
            <label for="longitude">Längengrad (z.B. 9.56025) aus Google Maps o.ä.:</label>
            <input type="text" id="longitude" placeholder="Enter Längengrad">
        </div>
        <button onclick="convertCoordinates()">Koordinaten umwandeln</button>


        <div class="result-box" id="result-1">
            <p><strong>NIVADIS GIS "Rechts":</strong> <span id="utmEasting">N/A</span></p>
        </div>
                <div class="result-box" id="result-2">
            <p><strong>zone:</strong> <span id="utmZone">N/A</span></p>

            <p><strong>NIVADIS GIS "Hoch":</strong> <span id="utmNorthing">N/A</span></p>
        </div>
        <div id="error-message" class="error"></div>
        <iframe width="597" height="250" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=9.699318408966066%2C47.484177893725764%2C9.729595184326174%2C47.49977861091604&amp;layer=mapnik&amp;marker=47.49197883161885%2C9.714467525482178" style="border: 1px solid black"></iframe>
    </div>

    <script>
        // Definiert das WGS84 (EPSG:4326) Koordinatensystem
        proj4.defs("EPSG:4326", "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs");

        function convertCoordinates() {
            const latitude = parseFloat(document.getElementById('latitude').value);
            const longitude = parseFloat(document.getElementById('longitude').value);
            const errorMessage = document.getElementById('error-message');

            errorMessage.textContent = ''; // Fehlermeldung zurücksetzen

            if (isNaN(latitude) || isNaN(longitude) || latitude < -90 || latitude > 90 || longitude < -180 || longitude > 180) {
                errorMessage.textContent = 'Bitte gültige Breiten- und Längengrade eingeben.';
                document.getElementById('utmZone').textContent = 'N/A';
                document.getElementById('utmEasting').textContent = 'N/A';
                document.getElementById('utmNorthing').textContent = 'N/A';
                return;
            }

            try {
                // Bestimme die UTM-Zone basierend auf dem Längengrad
                const utmZoneNumber = Math.floor((longitude + 180) / 6) + 1;
                const utmHemisphere = latitude >= 0 ? 'N' : 'S';
                const utmProjectionCode = `EPSG:326${utmZoneNumber}`; // Für nördliche Hemisphäre (WGS 84 / UTM zone XXN)

                // Definiere die UTM-Projektion für die spezifische Zone
                // Proj4js benötigt die Definition für die Ziel-Projektion
                // Beispiel: +proj=utm +zone=32 +datum=WGS84 +units=m +no_defs (für Zone 32N)
                // Die genaue Definition muss auf Basis der Zone dynamisch erstellt werden
                proj4.defs(utmProjectionCode, `+proj=utm +zone=${utmZoneNumber} +datum=WGS84 +units=m +no_defs`);
                
                // Für die südliche Hemisphäre müsste die Projektion anders definiert werden (+south)
                // Da dies eine kleine Web-Anwendung ist und der Fokus auf WGS84 liegt,
                // gehen wir davon aus, dass die meisten Nutzer im Norden sein werden.
                // Für eine vollständige Lösung müsste hier unterschieden werden:
                // if (utmHemisphere === 'S') { proj4.defs(utmProjectionCode, `+proj=utm +zone=${utmZoneNumber} +south +datum=WGS84 +units=m +no_defs`); }

                const utmCoordinates = proj4("EPSG:4326", utmProjectionCode, [longitude, latitude]);

                document.getElementById('utmZone').textContent = `${utmZoneNumber}`;
                document.getElementById('utmEasting').textContent = `${utmZoneNumber}` + utmCoordinates[0].toFixed(0);
                document.getElementById('utmNorthing').textContent = utmCoordinates[1].toFixed(0);

            } catch (e) {
                errorMessage.textContent = 'Fehler bei der Umrechnung: ' + e.message + '. Stellen Sie sicher, dass die Koordinaten gültig sind und die UTM-Zone korrekt abgeleitet werden kann.';
                document.getElementById('utmZone').textContent = 'N/A';
                document.getElementById('utmEasting').textContent = 'N/A';
                document.getElementById('utmNorthing').textContent = 'N/A';
            }
        }

        function getLocation() {
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = ''; // Fehlermeldung zurücksetzen

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
                        document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
                        convertCoordinates(); // Direkt nach dem Erhalt der Position umwandeln
                    },
                    (error) => {
                        let msg = '';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                msg = "Zugriff auf den Standort verweigert. Bitte erlauben Sie den Standortzugriff in Ihren Browsereinstellungen.";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                msg = "Standortinformationen sind nicht verfügbar.";
                                break;
                            case error.TIMEOUT:
                                msg = "Die Anfrage zur Standortbestimmung ist abgelaufen (Zeitüberschreitung).";
                                break;
                            case error.UNKNOWN_ERROR:
                                msg = "Ein unbekannter Fehler ist aufgetreten.";
                                break;
                        }
                        errorMessage.textContent = msg;
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            } else {
                errorMessage.textContent = "Ihr Browser unterstützt die Geolocation API nicht.";
            }
        }
    </script>
</body>
</html>